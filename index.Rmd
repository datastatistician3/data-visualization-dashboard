---
title: "Data Visualization Dashboard"
params:
output:
  flexdashboard::flex_dashboard:
    social: [ "menu" ]
    # orientation: rows
    vertical_layout: fill
    # source_code: embed
    theme: flatly
---

<!-- Replace the flexdashboard entry above with this, to produce our conventional knitr report. -->
<!-- html_document: -->
<!--   keep_md: yes -->
<!--   toc: yes -->
<!--   toc_float: true -->
<!--   number_sections: true -->


<!--  Set the working directory to the repository's base directory; this assumes the report is nested inside of three directories.-->
```{r, echo=F, message=F}
# cat("Working directory: ", getwd())
library(knitr)
library(flexdashboard)
opts_knit$set(root.dir='./')  #Don't combine this call with any other chunk -especially one that uses file paths.
```

<!-- Set the report-wide options, and point to the external code file. -->
```{r set-options, echo=F}
# cat("Working directory: ", getwd())
report_render_start_time <- Sys.time()
opts_chunk$set(
  results      = 'show',
  comment      = NA,
  tidy         = FALSE,
  # dpi        = 400,
  # out.width  = "650px", #This affects only the markdown, not the underlying png file.  The height will be scaled appropriately.
  fig.width    = 4,
  fig.height   = 4,
  fig.path     = 'figure-dashboard-png/'
)

echo_chunks    <- FALSE #Toggle for debugging.
message_chunks <- FALSE #Toggle for debugging.
options(width=100) #So the output is 25% wider than the default.

capitalize_each_word <- function(x){
  g <- l <- j <- list()
  g <- stringr::str_split(x, pattern = "[_|.| ]")
  for ( i in 1:length(g)){
    l[[i]] <- paste(Hmisc::capitalize(g[[i]]), collapse = " ")
    j[[i]] <- paste(l[[i]], collapse = " ")
}
  return(unlist(j))
}
```

<!-- Load 'sourced' R files.  Suppress the output when loading sources. -->
```{r load-sources, echo=echo_chunks, message=message_chunks}
```

<!-- Load packages, or at least verify they're available on the local machine.  Suppress the output when loading packages. -->
```{r load-packages, echo=echo_chunks, message=message_chunks}
```

<!-- Load any global functions and variables declared in the R file.  Suppress the output. -->
```{r declare-globals, echo=echo_chunks, results='show', message=message_chunks}
```

<!-- Declare any global functions specific to a Rmd output.  Suppress the output. -->
```{r rmd-specific, echo=echo_chunks, message=message_chunks}
# Put presentation-specific code in here.  It doesn't call a chunk in the codebehind file.
#   It should be rare (and used cautiously), but sometimes it makes sense to include code in Rmd
#   that doesn't live in the codebehind R file.
```

<!-- Load the datasets.   -->
```{r load-data, echo=echo_chunks, results='show', message=message_chunks}
```

<!-- Tweak the datasets.   -->
```{r tweak-data, echo=echo_chunks, results='show', message=message_chunks}
```

# Home
This dashboard presents data visualization methods using R language and flexdashboard.

## Overall {.tabset data-width=100}

### Notes

This dashboard presents visualization data of various time series and other data from different sources.

## Headline Graph  {.tabset}

### Map Data (quakes data)
```{r headline-graph, echo=echo_chunks, message=message_chunks}
library(leaflet)
quakes <- quakes %>%
  dplyr::mutate(mag.level = cut(mag,c(3,4,5,6),
                                labels = c('>3 & <=4', '>4 & <=5', '>5 & <=6')))

quakes.df <- split(quakes, quakes$mag.level)

l <- leaflet() %>% addTiles()

names(quakes.df) %>%
  purrr::walk( function(df) {
    l <<- l %>%
      addMarkers(data=quakes.df[[df]],
                          lng=~long, lat=~lat,
                          label=~as.character(mag),
                          popup=~as.character(mag),
                          group = df,
                          clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = F),
                          labelOptions = labelOptions(noHide = F,
                                                       direction = 'auto'))
  })

l %>%
  addLayersControl(
    overlayGroups = names(quakes.df),
    options = layersControlOptions(collapsed = FALSE)
  )
```

# Graphs 

## {.tabset}

### New Haven Temperature
<!-- fig dimensions are ignored in flexdashboard -->
```{r spaghetti, echo=echo_chunks, message=message_chunks, results='asis', fig.height=8, fig.width=20}
library(dygraphs)
dygraph(nhtemp, main="New Haven Temperatures") %>%
  dySeries(label="Temp (F)", color="black") %>%
  dyShading(from="1920-1-1", to="1930-1-1", color="#FFE6E6") %>%
  dyShading(from="1940-1-1", to="1950-1-1", color="#CCEBD6") %>% 
  dyAxis("y", label = "Temperature (F)", valueRange = c(40, 60)) %>% 
  dyAxis("x", label = "Years", valueRange = c(1909, 1975))
```

### UK Lung Deaths
<!-- fig dimensions are ignored in flexdashboard -->
```{r spaghetti1, echo=echo_chunks, message=message_chunks, results='asis', fig.height=8, fig.width=20}
library(dygraphs)
lungDeaths <- cbind(ldeaths, mdeaths, fdeaths)
dygraph(lungDeaths, main = "Deaths from Lung Disease (UK)") %>%
  dyOptions(colors = RColorBrewer::brewer.pal(3, "Set2")) %>% 
  dyAxis("y", label = "Number of Deaths", valueRange = c(0, 4000)) %>% 
  dyAxis("x", label = "Years", valueRange = c(1974, 1980))
```

### Ridgeline Graph
<!-- fig dimensions are ignored in flexdashboard -->
```{r spaghetti2, echo=echo_chunks, message=message_chunks, results='asis', fig.height=8, fig.width=20}
library(ggplot2)
library(ggridges)
ggplot(mpg, 
       aes(x = cty, 
           y = class, 
           fill = class)) +
  geom_density_ridges() + 
  theme_ridges() +
  labs("Highway mileage by auto class") +
  theme(legend.position = "none")
```


### Survial Graph
<!-- fig dimensions are ignored in flexdashboard -->
```{r spaghetti3, echo=echo_chunks, message=message_chunks, results='asis', fig.height=8, fig.width=20}
library(survminer)
require("survival")
fit <- survfit(Surv(time, status) ~ sex, data = lung)
ggsurv <- ggsurvplot(
           fit,                     # survfit object with calculated statistics.
           data = lung,             # data used to fit survival curves.
           risk.table = TRUE,       # show risk table.
           pval = TRUE,             # show p-value of log-rank test.
           conf.int = TRUE,         # show confidence intervals for 
                                    # point estimates of survival curves.
           palette = c("#E7B800", "#2E9FDF"),
           xlim = c(0,500),         # present narrower X axis, but not affect
                                    # survival estimates.
           xlab = "Time in days",   # customize X axis label.
           break.time.by = 100,     # break X axis in time intervals by 500.
           ggtheme = theme_light(), # customize plot and risk table with a theme.
          risk.table.y.text.col = T,# colour risk table text annotations.
          risk.table.height = 0.25, # the height of the risk table
          risk.table.y.text = FALSE,# show bars instead of names in text annotations
                                    # in legend of risk table.
          ncensor.plot = TRUE,      # plot the number of censored subjects at time t
          ncensor.plot.height = 0.25,
          conf.int.style = "step",  # customize style of confidence intervals
          surv.median.line = "hv",  # add the median survival pointer.
          legend.labs = 
            c("Male", "Female")    # change legend labels.
        )
ggsurv$table <- ggpar(
  ggsurv$table,
  font.title    = c(13, "bold.italic", "green"),
  font.subtitle = c(15, "bold", "pink"),
  font.caption  = c(11, "plain", "darkgreen"),
  font.x        = c(8, "bold.italic", "orange"),
  font.y        = c(11, "bold.italic", "darkgreen"),
  font.xtickslab = c(9, "bold", "red")
)


# Font for ncensor plot
ggsurv$ncensor.plot <- ggpar(
  ggsurv$ncensor.plot,
  font.title    = c(13, "bold.italic", "green"),
  font.subtitle = c(15, "bold", "pink"),
  font.caption  = c(11, "plain", "darkgreen"),
  font.x        = c(8, "bold.italic", "orange"),
  font.y        = c(11, "bold.italic", "darkgreen"),
  font.xtickslab = c(9, "bold", "red")
)

print(ggsurv)
```

### Plolty Graph
<!-- fig dimensions are ignored in flexdashboard -->
```{r spaghetti4, echo=echo_chunks, message=message_chunks, results='asis', fig.height=8, fig.width=20}
library(ggplot2)
library(plotly)
p <- plot_ly(ggplot2::diamonds, x = ~cut, y = ~price, color = ~clarity, type = "box") %>%
  layout(boxmode = "group")
p
# chart_link = api_create(p, filename="box-group")
# chart_link
```


# Tables

## {.tabset}

### mtcars dataset
```{r program-by-week-provider, echo=echo_chunks, message=message_chunks}
mtcars %>% 
  DT::datatable(
    colnames = toupper(colnames(.)),
    options = list(
      pageLength = 25, autoWidth = FALSE))
```

### kableExtra table
```{r cancellation-reasons, echo=echo_chunks, message=message_chunks}
library(kableExtra)
library(knitr)
library(dplyr)
iris[1:10, ] %>%
  mutate_if(is.numeric, function(x) {
    cell_spec(x, bold = T, 
              color = spec_color(x, end = 0.9),
              font_size = spec_font_size(x))
  }) %>%
  mutate(Species = cell_spec(
    Species, color = "white", bold = T,
    background = spec_color(1:10, end = 0.9, option = "A", direction = -1)
  )) %>%
  kable(escape = F, align = "c") %>%
  kable_styling(c("striped", "condensed"), full_width = F)
```


Summary Graphs
=============================================

## Marginals {.tabset storyboard}

```{r marginals, echo=echo_chunks, message=message_chunks, results='asis'}
data(churn, package = 'C50')
test <- churnTest
train <- churnTrain
ds <- rbind(test,train)

TabularManifest::histogram_discrete(d_observed=ds, variable_name="churn",  main_title = capitalize_each_word("churn"), x_title = capitalize_each_word("churn")) # %>% ggplotly()

TabularManifest::histogram_continuous(d_observed=ds, variable_name="total_day_minutes", bin_width=1, rounded_digits=0, main_title = capitalize_each_word("total_day_minutes"), y_title = "Count", x_title = capitalize_each_word("total_day_minutes")) # %>% ggplotly()

TabularManifest::histogram_continuous(d_observed=ds, variable_name="total_eve_minutes", bin_width=1, rounded_digits=0, main_title = capitalize_each_word("total_eve_minutes"), y_title = "Count", x_title = capitalize_each_word("total_eve_minutes")) # %>% ggplotly()

TabularManifest::histogram_continuous(d_observed=ds, variable_name="number_customer_service_calls", bin_width=1, rounded_digits=0, main_title = capitalize_each_word("number_customer_service_calls"), y_title = "Count", x_title = capitalize_each_word("number_customer_service_calls")) # %>% ggplotly()

TabularManifest::histogram_continuous(d_observed=ds, variable_name="total_intl_minutes", bin_width=0.01, rounded_digits=2, main_title = capitalize_each_word("total_intl_minutes"), y_title = "Count", x_title = capitalize_each_word("total_intl_minutes")) # %>% ggplotly()

TabularManifest::histogram_continuous(d_observed=ds,  variable_name="total_day_calls", bin_width=0.01, rounded_digits=2, main_title = capitalize_each_word("total_day_calls"), y_title = "Count", x_title = capitalize_each_word("total_day_calls")) # %>% ggplotly()

TabularManifest::histogram_continuous(d_observed=ds, variable_name="total_eve_charge", bin_width=0.01, rounded_digits=2, main_title = capitalize_each_word("total_eve_charge"), y_title = "Count", x_title = capitalize_each_word("total_eve_charge")) # %>% ggplotly()

TabularManifest::histogram_discrete(d_observed=ds, variable_name="international_plan",  main_title = capitalize_each_word("international_plan"), x_title = capitalize_each_word("international_plan")) # %>% ggplotly()

```

# Documentation
## {.tabset}

### About the Dashboard

This dashboard was built using `flexdashboard` package in R. This dashboard presents a multiple data visualization methods using various R packages. 

#### Resources

[Link to Caret R Package](https://rkabacoff.github.io/datavis/)

#### Contact

Som Bohora

email: [energeticsom@gmail.com](http://mail.google.com)

[GitHub Page](https://github.com/sbohora)


















